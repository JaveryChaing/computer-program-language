## JDK内存模型

> JDK  java开发环境包
>
> JRE  运行环境（装载类）
>
> JVM Java虚拟机（执行class文件）
>
> ![image-20220529220649691](img\image-20220529220649691.png) 
>
> **JVM 运行时数据区**
>
> 1. 程序计数器（下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等信息存储）
>
> 2. Java虚拟机栈（Stack） **存放编译期基本数据类型和对象引用指针**
>
>    > StackOverflowError：线程栈大小超出JVM内存限制，（多次递归）
>    >
>    > OutOfMemoryError：内存溢出
>
> 3. 本地方法栈 (JVM 调用操作系统API)
>
> 4. Java Heap (对象数据存放区，线程共享)
>
>    >  -XMs（堆初始容量）  -Xmx （堆最大容量）
>    >
>    > 新生代 （1/3） -Xmn 
>    >
>    > - Eden  （4/5）  GC后存活的对象移入From区
>    > - From  （1/10）与ToSurvivor 复制交换，每次GC都被清空
>    > - To Survivor （1/10）
>    >
>    > 老年代 （2/3） 
>
> 5. 方法区 （存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据）
>
> ---
>
> **内存分配方式**
>
> 1. 指针碰撞（内存地址连续，Serial和ParNew收集器） 
> 2. 空闲链表（CMS收集器和Mark-Sweep）
>
> ---
>
> **对象访问**
>
> 1. 句柄（reference） 程序不能直接通过句柄获取信息
> 2. 直接指针（基本数据类型）
>
> ---
>
>  **类加载器**
>
> > 1. 类全限定名获取二进制字节流Class文件
> > 2. 将Class文件转为运行时数据结构（常量，方法区，属性）
> > 3. 在内存中创建该类Class对象（对该类的对象创建数据访问入口）
> >
> > ![image-20220529214724435](img\image-20220529214724435.png) 
> >
> > **Linking：**
> >
> > 1. 验证 （保证二进制字节流中的信息符合虚拟机规范,并没有安全问题，使用-Xverify:none关闭，加快类加载时间）
> > 2. 准备（方法区中静态成员变量内存分配，0，fasle，null等）
> > 3. 解析 （对字段，类，接口，类方法解析，判断是否继承，复写）
> >
> > **JVM加载源**
> >
> > - Jar，War，Ear 等压缩文件
> > - JSP文件中Class类
> > - 数据库读取
> > - Applet网络加载
> > - 动态代理
>
> #### **类加载器**
>
> - Bootstrap （加载JDK中API，或通过-Xbootclasspath参数指定路径中的）
>
> - Extension （加载指定系统类库）
>
> - Application （加载用户自定义类库）
>
> - UserClassLoad
>
> - 双亲委派模型
>
>   > - 当一个类加载器收到类加载任务，**会先交给其父类加载器去完成**，**因此最终加载任务都会传递到顶 层的启动类加载器**，
>   > - 只有当父类加载器无法完成加载任务时，才会尝试执行加载任务
>   >
>   > ---
>   >
>   > 1. 避免重复加载
>   > 2. 类加载器与类名判断是否同一个Class
>
>   

- #### **JDK9**

  > - 接口方法可以使用private来修饰
  >
  > - 设置G1为JVM默认垃圾收集器
  >
  >   > 1. CMS 垃圾回收器
  >   >
  >   > 2. G1垃圾回收器（**延迟可控的情况下获得尽可能高的吞吐量**）
  >   >
  >   >    > -XX:G1HeapRegionSize 设置Region大小
  >   >    >
  >   >    > ![image-20220529203122549](img\image-20220529203122549.png) 
  >   >    >
  >   >    > 
  >   >    >
  >   >    > eden和old 不在物理隔离，通过Region动态分配实现逻辑连续
  >
  > - 支持http2.0和websocket的API

- #### **JDK17**

  > [JDK 17 API](https://docs.oracle.com/en/java/javase/17/)
